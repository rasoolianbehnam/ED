#include <pcap.h>
#include <stdio.h>
#include <stdlib.h>
#include <netinet/in.h>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <errno.h>

void pcap_fatal(const char *failed_in, const char *errbuf) {
    printf("Fatal Error in %s: %s\n", failed_in, errbuf);
    exit(1);
}

int main() {
    //struct pcap_pkthdr header;
    const u_char *packet;
    char errbuf[PCAP_ERRBUF_SIZE];
    char *dev, *net, *mask;
    bpf_u_int32 netp, maskp;
    //pcap_t *pcap_handle;
    //int i;
    int ret;
    struct in_addr addr;

    dev = pcap_lookupdev(errbuf);
    if(dev == NULL)
        pcap_fatal("pcap_lookupdev", errbuf);
    printf("Sniffing on device %s\n", dev);
    ret = pcap_lookupnet(dev, &netp, &maskp, errbuf);
    if (ret == -1) {
        printf("%s\n", errbuf);
        exit(1);
    }
    addr.s_addr = netp;
    net = inet_ntoa(addr);
    if (net == NULL) {
        perror("inet_ntoa");
        exit(1);
    }
    printf("IP address: %s\n", net);

    addr.s_addr = maskp;
    mask = inet_ntoa(addr);
    if (net == NULL) {
        perror("inet_ntoa");
        exit(1);
    }
    printf("mask address: %s\n", mask);

}
